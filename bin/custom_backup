#!/usr/bin/env ruby
# frozen_string_literal: true
puts '*******************************'
pp ARGV
puts '*******************************'
backup_dir = ''

# remove the -d if present
if ARGV[0] == '-d'
  ARGV.shift
  backup_dir = ARGV.shift
end

ARGV.each do |file|
  pp file
  new_name = "#{backup_dir}/#{File.basename(file)}.bak"
  mode = if File.exist?(new_name)
           puts "appending backup to #{new_name}"
           'a'
         else
           puts "creating backup to #{new_name}"
           'w'
         end
  pp new_name
  contents = "\n#{File.read(file)}"
  File.write(new_name, contents, mode: mode)
end
